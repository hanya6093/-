# 清仓机器人上位机控制

## 清仓机器人结构
清仓机器人结构分为3部分：车载工控机（上位机）、车载控制器、远程监控平台

### 通讯方面
上位机采用ROS系统与远程监控平台进行通讯，

车载控制器使用CANOpen协议使用CANalyst-II硬件（红色小盒）与工控机通讯

第一阶段：远程控制平台的手柄和方向盘使用CANOpen协议通过以太网的UDP协议进行无线传输，从而完成与底层车载控制器的直接通讯

> 改进：远程遥控手柄和方向盘可以通过UDP协议传输给CANalyst-II的CAN1口，随后通过USB口传输到工控机中，经过工控机处理后数据后，将CAN数据通过CAN2口输出给车载控制器。

改进后优势：完成控制可控，能够自行定义控制的输出量。可能会导致延迟增加

通讯硬件：CANalyst-II的CAN转USB、LCNET622E的CAN转网口(RJ-45接口)、LCWLAN的wifi转CAN、手柄和方向盘使用CANopen协议的CAN口输出、车载控制器使用CAN口、激光雷达使用RJ-45网口，双目摄像头和鱼眼摄像头使用usb口、IMU使用蓝牙、RS232/485和usb

## 工控机上位机整体通讯结构

### 功能

功能1：能够解析CAN数据，发送数据，即接收手柄数据、方向盘数据和车载控制器反馈数据

功能2：能够使用ROS通讯的话题通讯方式，将机器人的状态信息发送给监控平台

功能3：激光雷达、双目摄像头、IMU硬件的解析处理以及算法的实现

功能4：鱼眼图像的显示，如何修改鱼眼拼接程序

## 解决方案

### 控制和数据传输方法

将功能1和功能2的需求整合分解成两个模块，分别时车辆控制模块和监控平台控制模块

车辆控制模块进行车辆底层控制

监控平台模块进行车辆的上层控制并反馈信息给监控平台

## 待完成的任务

1、完成工控机的整体结构搭建，保证各个方面通讯正常

2、完成鱼眼相机的图像处理，取消拼接，变成四个图像传送

3、监控平台的搭建，将需要功能在监控平台上显示

4、完成工控机和车载控制器之间的CAN通讯检测，确保上位机能够发送数据给车载控制器，从而驱动车辆运动
